{% extends 'base.html' %}
{% block title %}Focus • Mind Mend{% endblock %}

{% block content %}
<section class="flex flex-col items-center justify-center text-center px-4 py-12 space-y-6">
  <h1 class="text-3xl md:text-4xl font-bold text-indigo-500 dark:text-indigo-300">🌸 Mind Mend Focus</h1>
  <p class="text-gray-600 dark:text-gray-300 max-w-md">
    Stay grounded and focus in calm intervals. Take breaks — your mind deserves it. 💭
  </p>

  <!-- Timer Settings -->
  <div class="flex flex-col md:flex-row gap-4 items-center">
    <div>
      <label for="work-time" class="block mb-1 text-gray-700 dark:text-gray-200">Work Duration (minutes)</label>
      <input id="work-time" type="number" min="1" max="120" value="25"
        class="w-24 px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200">
    </div>
    <div>
      <label for="break-time" class="block mb-1 text-gray-700 dark:text-gray-200">Break Duration (minutes)</label>
      <input id="break-time" type="number" min="1" max="60" value="5"
        class="w-24 px-3 py-2 rounded-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200">
    </div>
  </div>

  <!-- Timer Display -->
  <div class="mt-6 p-6 bg-white/60 dark:bg-gray-800/40 rounded-2xl shadow-md w-full max-w-sm">
    <h2 id="status" class="text-xl font-semibold text-indigo-700 dark:text-indigo-200 mb-2">Focus Time</h2>
    <div id="timer" class="text-5xl font-mono mb-4">25:00</div>
    <div class="flex justify-center gap-4">
      <button id="start" class="px-4 py-2 bg-indigo-500 text-white rounded-lg shadow hover:scale-105 transition">▶ Start</button>
      <button id="pause" class="px-4 py-2 bg-yellow-500 text-white rounded-lg shadow hover:scale-105 transition">⏸ Pause</button>
      <button id="reset" class="px-4 py-2 bg-gray-500 text-white rounded-lg shadow hover:scale-105 transition">🔄 Reset</button>
    </div>
  </div>
</section>

<!-- Alarm Sound -->
<audio id="alert-sound" src="{{ url_for('static', filename='alert.mp3') }}" preload="auto"></audio>

<script>
const timerDisplay = document.getElementById("timer");
const statusLabel = document.getElementById("status");
const startBtn = document.getElementById("start");
const pauseBtn = document.getElementById("pause");
const resetBtn = document.getElementById("reset");
const workInput = document.getElementById("work-time");
const breakInput = document.getElementById("break-time");
const alertSound = document.getElementById("alert-sound");

let timer;
let isRunning = false;
let timeLeft = parseInt(workInput.value) * 60;

function updateDisplay() {
  let minutes = Math.floor(timeLeft / 60);
  let seconds = timeLeft % 60;
  timerDisplay.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
}

function startTimer() {
  if (!isRunning) {
    isRunning = true;
    timer = setInterval(() => {
      if (timeLeft > 0) {
        timeLeft--;
        updateDisplay();
      } else {
        clearInterval(timer);
        isRunning = false;
        alertSound.play();

        // Wait for user confirmation before starting next session
        setTimeout(() => {
          if (confirm(`${statusLabel.textContent} ended! Ready for the next session?`)) {
            if (statusLabel.textContent === "Focus Time") {
              statusLabel.textContent = "Break Time ☕";
              timeLeft = parseInt(breakInput.value) * 60;
            } else {
              statusLabel.textContent = "Focus Time";
              timeLeft = parseInt(workInput.value) * 60;
            }
            updateDisplay();
            startTimer();
          }
        }, 100); // slight delay to ensure audio plays
      }
    }, 1000);
  }
}

function pauseTimer() {
  clearInterval(timer);
  isRunning = false;
}

function resetTimer() {
  clearInterval(timer);
  isRunning = false;
  timeLeft = parseInt(workInput.value) * 60;
  statusLabel.textContent = "Focus Time";
  updateDisplay();
}

startBtn.addEventListener("click", startTimer);
pauseBtn.addEventListener("click", pauseTimer);
resetBtn.addEventListener("click", resetTimer);

updateDisplay();
</script>
{% endblock %}
